<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>

</head>

<body>
    <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-sm">
            <img class="mx-auto h-10 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=500"
                alt="Your Company">
            <h2 class="mt-10 text-center text-2xl font-bold leading-9 tracking-tight text-black">Sign Up
            </h2>
        </div>

        <div class="mt-10 sm:mx-auto sm:w-full sm:max-w-sm">
            <form class="space-y-6" id="registerForm" onsubmit="return validatePassword()">
                <div>
                    <label for="name" class="block text-sm font-medium leading-6 text-black">Name</label>
                    <div class="mt-2">
                        <input id="name" name="name" type="text" required
                            class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-black shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6">
                    </div>
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium leading-6 text-black">Email
                        address</label>
                    <div class="mt-2">
                        <input id="email" name="email" type="email" autocomplete="email" required
                            class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-black shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6">
                    </div>
                </div>

                <div>
                    <div class="flex items-center justify-between">
                        <label for="password" class="block text-sm font-medium leading-6 text-black">Password</label>
                    </div>
                    <div class="mt-2">
                        <input id="password" name="password" type="password" autocomplete="current-password" required
                            class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-black shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6 ">
                    </div>
                </div>
                <div>
                    <div class="flex items-center justify-between">
                        <label for="referral" class="block text-sm font-medium leading-6 text-black">Referral
                            Code</label>
                    </div>
                    <div class="mt-2">
                        <input id="referral" name="referral" type="text"
                            class="block w-full rounded-md border-0 bg-white/5 py-1.5 text-black shadow-sm ring-1 ring-inset ring-white/10 focus:ring-2 focus:ring-inset focus:ring-indigo-500 sm:text-sm sm:leading-6 ">
                    </div>
                </div>

                <div>
                    <button type="submit"
                        class="flex w-full justify-center rounded-md bg-indigo-500 px-3 py-1.5 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-indigo-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-500">Sign
                        Up</button>
                </div>
            </form>

            <p class="mt-10 text-center text-sm text-gray-400">
                Already have an account?
                <a href="/auth/login" class="font-semibold leading-6 text-indigo-400 hover:text-indigo-300">login</a>
            </p>
        </div>
    </div>

    <form class="space-y-6 flex justify-center" id="registerForm" action="/api/v1/auth/google" method="get">
        <button
            class=" bg-black px-4 py-2 border flex gap-2 border-slate-200 dark:border-slate-700 rounded-lg text-slate-700 dark:text-slate-200 hover:border-slate-400 dark:hover:border-slate-500 hover:text-slate-900 dark:hover:text-slate-300 hover:shadow transition duration-150">
            <img class="w-6 h-6" src="https://www.svgrepo.com/show/475656/google-color.svg" loading="lazy"
                alt="google logo">
            <span>Sign Up with Google</span>
        </button>
        </button>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                // Registration Form Submission
                const registrationForm = document.getElementById('registerForm');
                if (registrationForm) {
                    registrationForm.addEventListener('submit', function (event) {
                        event.preventDefault(); // Prevent the default form submission

                        if (!validatePassword()) {
                            return false; // Stop here if password validation fails
                        }

                        var formData = new FormData(this);
                        var object = {};
                        formData.forEach(function (value, key) {
                            object[key] = value;
                        });
                        var json = JSON.stringify(object);
                        // Adjust the URL to the correct endpoint for registration
                        fetch('/api/v1/auth/register', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Accept': 'application/json'
                            },
                            body: json
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    window.location.href = `/dashboard?token=${data.data.token}`; // Redirect on success
                                }
                                else {
                                    alert('Registration failed: ' + (data.error || 'Unknown error'));
                                }
                            })
                            .catch((error) => {
                                console.error('Error:', error);
                            });
                    });
                }
            });

            function validatePassword() {
                const passwordInput = document.getElementById('password');
                const password = passwordInput.value;
                const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

                if (!passwordPattern.test(password)) {
                    alert('Password must be at least 8 characters and include lowercase, uppercase, digit, and special character.');
                    return false;
                }
                return true;
            }
        </script>

</body>

</html>