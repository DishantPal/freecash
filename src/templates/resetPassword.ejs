<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>

</head>

<body class="h-full bg-gray-900">
    <div class="flex min-h-full flex-col justify-center px-6 py-12 lg:px-8">
        <div class="sm:mx-auto sm:w-full sm:max-w-md">
            <img class="mx-auto h-12 w-auto" src="https://tailwindui.com/img/logos/mark.svg?color=indigo&shade=500"
                alt="Your Company">
            <h2 class="mt-6 text-center text-3xl font-extrabold text-white">Reset Password</h2>
        </div>

        <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
            <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
                <form class="space-y-6" id="resetPasswordForm" method="POST">
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">New Password</label>
                        <div class="mt-1">
                            <input id="password" name="password" type="password" autocomplete="new-password" required
                                class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                    </div>

                    <div>
                        <button type="submit"
                            class="group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Reset Password
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const registrationForm = document.getElementById('resetPasswordForm');
            if (registrationForm) {
                registrationForm.addEventListener('submit', function (event) {
                    event.preventDefault(); // Prevent the default form submission

                    if (!validatePassword()) {
                        return false; // If password validation fails
                    }

                    var formData = new FormData(this);
                    var object = {};
                    formData.forEach(function (value, key) {
                        object[key] = value;
                    });
                    var json = JSON.stringify(object);

                    // Extract 'token' from the current URL query parameters
                    const queryParams = new URLSearchParams(window.location.search);
                    const token = queryParams.get('token'); // Assuming the query parameter is named 'token'

                    // Append 'token' to your API endpoint URL
                    fetch(`/api/v1/auth/reset-password/?token=${token}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: json
                    })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data);
                            if (data.success) {
                                window.location.href = `/dashboard?token=${token}`; // Redirect on success
                            } else {
                                alert('Reset failed: ' + (data.error || 'Unknown error'));
                            }
                        })
                        .catch((error) => {
                            console.error('Error:', error);
                        });
                });
            }
        });

        function validatePassword() {
            const passwordInput = document.getElementById('password');
            const password = passwordInput.value;
            const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

            if (!passwordPattern.test(password)) {
                alert('Password must be at least 8 characters and include at least one lowercase letter, one uppercase letter, one digit, and one special character.');
                return false;
            }
            return true;
        }
    </script>

</body>

</html>